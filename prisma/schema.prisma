// This is your Prisma schema file
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  TUTOR
  LEARNER
  APPLICANT
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum AssignmentType {
  QUIZ
  CODING
  ESSAY
}

enum CourseOfInterest {
  DIGITAL_MARKETING
  COMPUTER_BASICS
  GRAPHICS_DESIGN
  WEB_DESIGN
}

model User {
  id             String       @id @default(uuid())
  email          String       @unique
  username       String       @unique
  firstName      String
  lastName       String
  password       String
  role           UserRole     @default(LEARNER)
  avatar         String?
  isEmailVerified Boolean     @default(false)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  courses        Course[]     // Courses created as tutor
  enrollments    Enrollment[]
  progress       Progress[]
  submissions    Submission[]
}

model Course {
  id          String   @id @default(uuid())
  tutorId     String
  tutor       User     @relation(fields: [tutorId], references: [id])
  title       String
  description String   @db.Text
  level       CourseLevel @default(BEGINNER)
  duration    Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  lessons      Lesson[]
  assignments  Assignment[]
  enrollments  Enrollment[]
}

model Lesson {
  id        String      @id @default(uuid())
  courseId  String
  course    Course      @relation(fields: [courseId], references: [id], onDelete: Cascade)
  title     String
  content   String?     @db.Text
  videoUrl  String?
  order     Int
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  description String? @db.Text
  
  // Relations
  progress   Progress[]
}

model Assignment {
  id          String         @id @default(uuid())
  courseId    String
  course      Course         @relation(fields: [courseId], references: [id], onDelete: Cascade)
  title       String
  description String         @db.Text
  type        AssignmentType
  maxScore    Int
  timeLimit   Int?           // in minutes
  dueDate     DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  
  // Relations
  submissions Submission[]
}

model Enrollment {
  id          String    @id @default(uuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  courseId    String
  course      Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  enrolledAt  DateTime  @default(now())
  completedAt DateTime?
  progress    Float     @default(0) // 0-100

  @@unique([userId, courseId])
}

model Progress {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  lessonId     String
  lesson       Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  completed    Boolean  @default(false)
  timeSpent    Int?     // in seconds
  lastAccessAt DateTime @default(now())

  @@unique([userId, lessonId])
}

model Submission {
  id           String    @id @default(uuid())
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  assignmentId String
  assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  answers      Json
  score        Int?
  feedback     String?   @db.Text
  submittedAt  DateTime  @default(now())
  gradedAt     DateTime?
  
  @@unique([userId, assignmentId])
}

model Applicant {
  id              String          @id @default(uuid())
  firstName       String
  lastName        String
  email           String          @unique
  phone           String
  courseOfInterest CourseOfInterest
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}
